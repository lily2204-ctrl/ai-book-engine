<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>lifebook - Create Your Book</title>

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#eef1ff,#f8f9ff);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
  padding:20px;
}

.container{
  width:900px;
  max-width:95vw;
  background:#fff;
  padding:40px;
  border-radius:28px;
  box-shadow:0 25px 60px rgba(0,0,0,0.08);
  text-align:center;
}

/* LOGO CENTER */
.logoWrap{
  display:flex;
  justify-content:center;
  margin-bottom:20px;
}
.logoWrap img{
  width:180px;
}

/* STEP */
.step{
  font-size:12px;
  letter-spacing:2px;
  color:#777;
  margin-bottom:10px;
}

h1{
  font-size:40px;
  margin:0 0 25px;
  font-weight:900;
}

/* AVATAR */
.avatar{
  width:120px;
  height:120px;
  border-radius:50%;
  background:#f4f6ff;
  border:2px dashed #d4d4d4;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  margin:auto;
  overflow:hidden;
}
.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:none;
}
.avatar span{
  font-size:30px;
  opacity:.4;
}
input[type=file]{display:none;}

.row{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:20px;
}
input,select{
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:16px;
}

.styles{
  margin-top:30px;
}
.styleCard{
  padding:12px 18px;
  border:2px solid #eee;
  border-radius:14px;
  cursor:pointer;
  margin:5px;
  font-weight:600;
}
.styleCard.active{
  background:#111;
  color:white;
  border-color:#111;
}

button{
  margin-top:30px;
  padding:16px 40px;
  border:none;
  border-radius:18px;
  background:linear-gradient(90deg,#111,#333);
  color:white;
  font-weight:800;
  font-size:16px;
  cursor:pointer;
}
button:disabled{opacity:.6;}

.badge{
  margin-top:25px;
  font-size:12px;
  color:#777;
}
.msg{margin-top:10px;font-weight:700;}
.err{color:#c40000;}
.ok{color:#0b8a00;}
</style>
</head>

<body>
<div class="container">

<div class="logoWrap">
  <img src="lifebook-logo.png" alt="lifebook"/>
</div>

<div class="step">STEP 1 OF 2</div>
<h1>Create Your Personalized Book</h1>

<label class="avatar">
  <input type="file" id="photoInput" accept="image/*"/>
  <img id="avatarPreview"/>
  <span id="avatarIcon">+</span>
</label>

<div class="row">
  <input id="childName" placeholder="Child name"/>
  <select id="age">
    <option>3</option><option>4</option><option selected>5</option><option>6</option>
  </select>
  <select id="theme">
    <option>Magical Forest</option>
    <option>Space Adventure</option>
  </select>
</div>

<div class="styles">
  <div class="styleCard active" data-style="Soft Storybook">Soft Storybook</div>
  <div class="styleCard" data-style="Pixar 3D">Pixar 3D</div>
  <div class="styleCard" data-style="Magical Fantasy">Magical Fantasy</div>
</div>

<button id="createBtn">Generate My Book</button>

<div class="badge">AI Generated Story & Illustrations</div>
<div id="msg" class="msg"></div>

</div>

<script>
const API_BASE="https://romantic-patience-production.up.railway.app";
let selectedStyle="Soft Storybook";

document.querySelectorAll(".styleCard").forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll(".styleCard").forEach(x=>x.classList.remove("active"));
    c.classList.add("active");
    selectedStyle=c.dataset.style;
  }
});

photoInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>{
    avatarPreview.src=reader.result;
    avatarPreview.style.display="block";
    avatarIcon.style.display="none";
  };
  reader.readAsDataURL(file);
};

createBtn.onclick=async()=>{
  const name=document.getElementById("childName").value.trim();
  if(!name){msg.textContent="Enter child name";msg.className="msg err";return;}

  createBtn.disabled=true;
  msg.textContent="Creating book...";

  const res=await fetch(`${API_BASE}/create-book`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      child_name:name,
      age:age.value,
      story_type:theme.value,
      illustration_style:selectedStyle
    })
  });

  const data=await res.json();
  if(!res.ok){msg.textContent="Error";msg.className="msg err";createBtn.disabled=false;return;}

  localStorage.setItem("bookData",JSON.stringify(data));
  window.location.href="preview.html";
};
</script>
</body>
</html>
