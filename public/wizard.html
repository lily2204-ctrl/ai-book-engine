<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifebook - Premium AI Storybook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lang-active { border-color: #2563eb; background-color: #eff6ff; color: #1e40af; }
        .loading-ring { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-left transition-all duration-300">

    <div class="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-8 rounded-3xl text-white shadow-2xl">
                <h2 class="text-2xl font-bold mb-6 italic">Premium Experience</h2>
                <ul class="space-y-4 text-sm font-light">
                    <li class="flex items-center gap-3">âœ¨ <span>Hardcover Physical Book</span></li>
                    <li>ğŸ¨ <span>24 High-Definition Illustrations</span></li>
                    <li>âœï¸ <span>Personalized Story by AI</span></li>
                    <li>ğŸšš <span>Free Express Shipping</span></li>
                </ul>
                <div class="mt-8 pt-6 border-t border-white/20 text-center">
                    <span class="text-4xl font-bold">$49.00</span>
                    <p class="text-blue-100 text-xs mt-2">All inclusive â€¢ No hidden fees</p>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2 bg-white rounded-3xl p-8 md:p-12 shadow-sm border border-gray-100">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-8">Design Your Story</h1>

            <div class="mb-8">
                <label class="block text-sm font-bold text-gray-700 mb-3">Story Language:</label>
                <div class="flex gap-4">
                    <button onclick="changeLang('English', this)" class="lang-btn flex-1 py-3 px-4 border-2 rounded-xl font-bold lang-active transition-all">ğŸ‡ºğŸ‡¸ English</button>
                    <button onclick="changeLang('Hebrew', this)" class="lang-btn flex-1 py-3 px-4 border-2 rounded-xl font-bold border-gray-100 text-gray-500 transition-all">ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª</button>
                </div>
            </div>

            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="name" placeholder="Child's Name" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-400">
                    <input type="number" id="age" placeholder="Age" class="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div onclick="document.getElementById('fileInput').click()" class="border-2 border-dashed border-blue-100 bg-blue-50/20 rounded-2xl p-10 text-center cursor-pointer hover:bg-blue-50 transition-all">
                    <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="handlePreview(this)">
                    <div id="uploadPlaceholder">
                        <span class="text-4xl block mb-2">ğŸ“¸</span>
                        <p class="text-sm font-medium text-blue-600">Upload Photo for Face Sync</p>
                        <p class="text-xs text-gray-400 mt-1">Recommended for better AI consistency</p>
                    </div>
                    <img id="previewImg" class="hidden h-32 w-32 rounded-full mx-auto object-cover border-4 border-white shadow-lg">
                </div>

                <button onclick="generateBook()" id="mainBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl shadow-lg shadow-blue-200 flex justify-center items-center gap-3 transition-transform active:scale-95">
                    <span id="btnText">Generate My Book</span>
                    <div id="loader" class="loading-ring hidden"></div>
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedLang = "English";
        let base64Photo = "";

        function changeLang(lang, btn) {
            selectedLang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('lang-active', 'border-blue-600'));
            btn.classList.add('lang-active');
            document.body.dir = lang === 'Hebrew' ? 'rtl' : 'ltr';
            document.body.classList.toggle('text-right', lang === 'Hebrew');
            document.getElementById('btnText').innerText = lang === 'Hebrew' ? '×¦×•×¨ ××ª ×”×¡×¤×¨ ×©×œ×™' : 'Generate My Book';
        }

        function handlePreview(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                base64Photo = e.target.result;
                document.getElementById('uploadPlaceholder').classList.add('hidden');
                const img = document.getElementById('previewImg');
                img.src = e.target.result;
                img.classList.remove('hidden');
            };
            reader.readAsDataURL(input.files[0]);
        }

        async function generateBook() {
            const name = document.getElementById('name').value;
            if(!name) return alert("Please enter the child's name");

            // UI Feedback
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('mainBtn').disabled = true;

            try {
                let charDesc = "";
                // 1. Analyze Face
                if(base64Photo) {
                    const charRes = await fetch('/generate-character', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ child_photo: base64Photo })
                    });
                    const charData = await charRes.json();
                    charDesc = charData.characterDescription;
                }

                // 2. Build Story
                const bookRes = await fetch('/create-book', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        child_name: name,
                        age: document.getElementById('age').value,
                        story_type: 'Magic Adventure',
                        language: selectedLang,
                        character_description: charDesc
                    })
                });
                // ×‘×ª×•×š wizard.html - ×‘×ª×•×š ×¤×•× ×§×¦×™×™×ª generateBook
const bookData = await bookRes.json();

// ×©××™×¨×ª ×”× ×ª×•× ×™× ×›×“×™ ×©×“×£ ×”-Preview ×™×•×›×œ ×œ×§×¨×•× ××•×ª×
sessionStorage.setItem('lastGeneratedBook', JSON.stringify(bookData));

// ××¢×‘×¨ ×œ×“×£ ×”×ª×¦×•×’×” ×”××§×“×™××”
window.location.href = "/preview.html";
        }
    </script>
</body>
</html>
