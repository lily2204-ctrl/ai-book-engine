<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Create Your AI Book</title>

<style>
/* --- LIFeBOOK Animated Logo --- */
.logoWrap{
  display:flex;
  justify-content:center;
  align-items:center;
  margin: 0 0 18px 0;
}
.lifebookLogo{
  width: 260px;
  max-width: 70vw;
  height: auto;
  filter: drop-shadow(0 10px 22px rgba(0,0,0,.10));
}

.lbGlow{
  animation: lbGlow 2.2s ease-in-out infinite;
  transform-origin: 50% 50%;
}
@keyframes lbGlow{
  0%,100% { opacity:.55; transform: scale(1); }
  50% { opacity:1; transform: scale(1.02); }
}

.lbStroke{
  stroke-dasharray: 520;
  stroke-dashoffset: 520;
  animation: lbDraw 1.4s ease forwards;
}
@keyframes lbDraw{
  to { stroke-dashoffset: 0; }
}

.lbShimmer{
  animation: lbShimmer 2.8s linear infinite;
}
@keyframes lbShimmer{
  0%   { transform: translateX(-120px); opacity: 0; }
  15%  { opacity: .35; }
  50%  { opacity: .18; }
  100% { transform: translateX(120px); opacity: 0; }
}

.lbBook{
  transform-origin: 50% 62%;
  animation: lbBook 2.2s ease-in-out infinite;
}
@keyframes lbBook{
  0%,100% { transform: rotate(0deg) translateY(0px); }
  50% { transform: rotate(-2deg) translateY(-1px); }
}
</style>
  
body{
  font-family:Arial;
  background:linear-gradient(135deg,#eef1ff,#f8f9ff);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}

/* MAIN CARD */
.container{
  width:900px;
  max-width:95vw;
  background:white;
  padding:50px;
  border-radius:28px;
  box-shadow:0 25px 60px rgba(0,0,0,0.08);
  text-align:center;
  animation:fadeIn .5s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(15px)}
  to{opacity:1;transform:translateY(0)}
}

/* STEP INDICATOR */
.step{
  font-size:13px;
  letter-spacing:2px;
  color:#888;
  margin-bottom:12px;
}

h1{
  font-size:38px;
  margin:0 0 35px 0;
  font-weight:800;
}

.row{
  display:flex;
  gap:16px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
}

input,select{
  padding:14px 16px;
  border:1px solid #e4e4e4;
  border-radius:14px;
  font-size:16px;
  min-width:160px;
}

input:focus,select:focus{
  outline:none;
  border-color:#111;
}

/* AVATAR */
.avatar{
  width:110px;
  height:110px;
  border-radius:50%;
  background:#f2f3ff;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  border:2px dashed #dcdcff;
  transition:.2s;
}

.avatar:hover{
  border-color:#111;
}

.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

input[type="file"]{
  display:none;
}

/* STYLE CARDS */
.styleCard{
  padding:14px 20px;
  border-radius:16px;
  border:2px solid #eee;
  cursor:pointer;
  font-weight:600;
  transition:0.2s;
  background:#fafaff;
}

.styleCard:hover{
  border-color:#111;
  transform:translateY(-3px);
}

.styleCard.active{
  border-color:#111;
  background:#111;
  color:white;
}

/* BUTTON */
button{
  margin-top:40px;
  padding:18px 40px;
  border:none;
  border-radius:18px;
  background:linear-gradient(90deg,#111,#333);
  color:#fff;
  font-weight:800;
  font-size:17px;
  cursor:pointer;
  transition:0.25s;
}

button:hover{
  transform:scale(1.06);
  box-shadow:0 15px 35px rgba(0,0,0,0.2);
}

.hint{
  margin-top:18px;
  color:#888;
  font-size:14px;
}

.msg{
  margin-top:16px;
  font-weight:700;
}
.err{color:#c40000;}
.ok{color:#0b8a00;}
</style>
</head>

<body>
<div class="container">
<div class="logoWrap">
  <!-- lifebook animated logo (inline SVG) -->
  <svg class="lifebookLogo" viewBox="0 0 520 160" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="lifebook">
    <defs>
      <linearGradient id="lbGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#111"/>
        <stop offset="0.55" stop-color="#111"/>
        <stop offset="1" stop-color="#111"/>
      </linearGradient>

      <!-- Gold accent -->
      <linearGradient id="lbGold" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#b8892b"/>
        <stop offset="0.5" stop-color="#f1d28a"/>
        <stop offset="1" stop-color="#b8892b"/>
      </linearGradient>

      <clipPath id="lbClip">
        <rect x="0" y="0" width="520" height="160" rx="18"/>
      </clipPath>
    </defs>

    <!-- subtle shimmer pass -->
    <g clip-path="url(#lbClip)">
      <rect class="lbShimmer" x="90" y="18" width="90" height="130" fill="url(#lbGold)" opacity="0"/>
    </g>

    <!-- icon: minimalist open book -->
    <g class="lbBook" transform="translate(34,28)">
      <path d="M60 18 C42 10, 24 12, 14 22 C8 30, 8 92, 14 100 C24 110, 42 112, 60 104
               C78 112, 96 110, 106 100 C112 92, 112 30, 106 22 C96 12, 78 10, 60 18 Z"
            fill="#fff" opacity="0.9"/>
      <path d="M60 22 C45 14, 28 16, 20 24 C16 30, 16 90, 20 96 C28 104, 45 106, 60 98"
            fill="#f7f7f7"/>
      <path d="M60 22 C75 14, 92 16, 100 24 C104 30, 104 90, 100 96 C92 104, 75 106, 60 98"
            fill="#f2f2f2"/>

      <!-- spine line -->
      <path d="M60 22 L60 98" stroke="#111" stroke-width="3" opacity="0.25"/>

      <!-- gold highlight -->
      <path d="M22 36 C32 30, 44 30, 56 34" stroke="url(#lbGold)" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
      <path d="M64 34 C76 30, 88 30, 98 36" stroke="url(#lbGold)" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
    </g>

    <!-- wordmark -->
    <g transform="translate(170,92)">
      <text x="0" y="0" font-family="Arial, Helvetica, sans-serif" font-size="64" font-weight="800" fill="url(#lbGrad)" letter-spacing="0.5">
        lifebook
      </text>

      <!-- underline stroke draw -->
      <path class="lbStroke" d="M6 22 C70 44, 210 44, 334 20"
            fill="none" stroke="url(#lbGold)" stroke-width="6" stroke-linecap="round"/>
      <!-- small glow dot -->
      <circle class="lbGlow" cx="345" cy="18" r="5" fill="url(#lbGold)"/>
    </g>
  </svg>
</div>
  
<div class="step">STEP 1 OF 2</div>
<h1>Create Your Personalized Book</h1>

<div class="row">

<label class="avatar">
  <input type="file" id="photoInput" accept="image/*" />
  <img id="avatarPreview" style="display:none;" />
  <span id="avatarIcon">+</span>
</label>

<input id="childName" placeholder="Child name" />

<select id="age">
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5" selected>5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select>

<select id="theme">
  <option>Magical Forest</option>
  <option>Space Adventure</option>
  <option>Underwater Kingdom</option>
  <option>Superhero Day</option>
</select>

</div>

<div style="margin-top:40px;">
<h3 style="margin-bottom:15px;">Select Illustration Style</h3>

<div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;">

<div class="styleCard active" data-style="Soft Storybook">Soft Storybook</div>
<div class="styleCard" data-style="Pixar 3D">Pixar 3D</div>
<div class="styleCard" data-style="Magical Fantasy">Magical Fantasy</div>
<div class="styleCard" data-style="Minimal Scandinavian">Minimal Scandinavian</div>

</div>
</div>

<button id="createBtn">Generate My Book</button>

<div class="hint">Upload photo (optional). Fill details and continue.</div>
<div id="msg" class="msg"></div>

</div>

<script>
const API_BASE = "https://romantic-patience-production.up.railway.app";

const photoInput = document.getElementById("photoInput");
const avatarPreview = document.getElementById("avatarPreview");
const avatarIcon = document.getElementById("avatarIcon");
const msgEl = document.getElementById("msg");
const createBtn = document.getElementById("createBtn");

let selectedStyle = "Soft Storybook";

// IMAGE PREVIEW
photoInput.addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    avatarPreview.src = e.target.result;
    avatarPreview.style.display = "block";
    avatarIcon.style.display = "none";
  };
  reader.readAsDataURL(file);
});

// STYLE SELECT
document.querySelectorAll(".styleCard").forEach(card=>{
  card.addEventListener("click", function(){
    document.querySelectorAll(".styleCard").forEach(c=>c.classList.remove("active"));
    this.classList.add("active");
    selectedStyle = this.dataset.style;
  });
});

// CREATE BOOK
createBtn.addEventListener("click", async function(){

  const childName = document.getElementById("childName").value.trim();
  const age = document.getElementById("age").value;
  const theme = document.getElementById("theme").value;

  if(!childName){
    msgEl.textContent = "Please enter child name.";
    msgEl.className = "msg err";
    return;
  }

  msgEl.textContent = "Creating your book...";
  msgEl.className = "msg";

  try{
    const res = await fetch(`${API_BASE}/create-book`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        child_name: childName,
        age,
        story_type: theme,
        illustration_style: selectedStyle
      })
    });

    const data = await res.json();

    if(!res.ok){
      msgEl.textContent = data.message || "Error creating book.";
      msgEl.className = "msg err";
      return;
    }

    localStorage.setItem("bookData", JSON.stringify(data));

    msgEl.textContent = "Success!";
    msgEl.className = "msg ok";

    setTimeout(()=>{
      window.location.href = "preview.html";
    },500);

  }catch(err){
    msgEl.textContent = "Network error.";
    msgEl.className = "msg err";
  }
});
</script>

</body>
</html>
