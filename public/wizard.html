<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Create Your AI Book</title>

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#f6f7ff,#eef1ff);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container{
  width:900px;
  max-width:95vw;
  text-align:center;
  animation:fadeIn .5s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}
h1{
  font-size:42px;
  margin-bottom:30px;
  font-weight:800;
}
.row{
  display:flex;
  gap:14px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
}
input,select{
  padding:12px 14px;
  border:1px solid #ddd;
  border-radius:12px;
  font-size:16px;
}
button{
  padding:14px 22px;
  border:none;
  border-radius:14px;
  background:linear-gradient(90deg,#111,#333);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition:0.2s;
}
button:hover{
  transform:scale(1.05);
}
.avatar{
  width:100px;
  height:100px;
  border-radius:50%;
  background:#eee;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  border:2px dashed #ccc;
  transition:.2s;
}
.avatar:hover{
  border-color:#111;
}
.avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}
input[type="file"]{
  display:none;
}
.styleCard{
  padding:14px 18px;
  border-radius:14px;
  border:2px solid #ddd;
  cursor:pointer;
  font-weight:600;
  transition:0.2s;
}
.styleCard:hover{
  border-color:#111;
}
.styleCard.active{
  border-color:#111;
  background:#111;
  color:white;
}
.hint{
  margin-top:16px;
  color:#777;
}
.msg{
  margin-top:14px;
  font-weight:700;
}
.err{color:#c40000;}
.ok{color:#0b8a00;}
</style>
</head>

<body>
<div class="container">

<h1>Create Your AI Book</h1>

<div class="row">

<label class="avatar">
  <input type="file" id="photoInput" accept="image/*" />
  <img id="avatarPreview" style="display:none;" />
  <span id="avatarIcon">+</span>
</label>

<input id="childName" placeholder="Child name" />

<select id="age">
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5" selected>5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select>

<select id="theme">
  <option>Magical Forest</option>
  <option>Space Adventure</option>
  <option>Underwater Kingdom</option>
  <option>Superhero Day</option>
</select>

</div>

<div style="margin-top:30px;">
<h3>Select Illustration Style</h3>

<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:12px;">

<div class="styleCard active" data-style="Soft Storybook">Soft Storybook</div>
<div class="styleCard" data-style="Pixar 3D">Pixar 3D</div>
<div class="styleCard" data-style="Magical Fantasy">Magical Fantasy</div>
<div class="styleCard" data-style="Minimal Scandinavian">Minimal Scandinavian</div>

</div>
</div>

<div style="margin-top:30px;">
<button id="createBtn">Create Book</button>
</div>

<div class="hint">Upload a photo (optional). Fill name and click Create Book.</div>
<div id="msg" class="msg"></div>

</div>

<script>
const API_BASE = "https://romantic-patience-production.up.railway.app";

const photoInput = document.getElementById("photoInput");
const avatarPreview = document.getElementById("avatarPreview");
const avatarIcon = document.getElementById("avatarIcon");
const msgEl = document.getElementById("msg");
const createBtn = document.getElementById("createBtn");

let selectedStyle = "Soft Storybook";

// ===== IMAGE PREVIEW =====
photoInput.addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;

  if(!file.type.startsWith("image/")){
    alert("Please select an image file.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e){
    avatarPreview.src = e.target.result;
    avatarPreview.style.display = "block";
    avatarIcon.style.display = "none";

    // שומרים אופציונלי להמשך
    localStorage.setItem("childPhotoPreview", e.target.result);
  };
  reader.readAsDataURL(file);
});

// ===== STYLE SELECT =====
document.querySelectorAll(".styleCard").forEach(card=>{
  card.addEventListener("click", function(){
    document.querySelectorAll(".styleCard").forEach(c=>c.classList.remove("active"));
    this.classList.add("active");
    selectedStyle = this.dataset.style;
  });
});

// ===== CREATE BOOK =====
createBtn.addEventListener("click", async function(){

  const childName = document.getElementById("childName").value.trim();
  const age = document.getElementById("age").value;
  const theme = document.getElementById("theme").value;

  if(!childName){
    msgEl.textContent = "Please enter child name.";
    msgEl.className = "msg err";
    return;
  }

  msgEl.textContent = "Creating your book...";
  msgEl.className = "msg";

  try{
    const res = await fetch(`${API_BASE}/create-book`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        child_name: childName,
        age,
        story_type: theme,
        illustration_style: selectedStyle
      })
    });

    const data = await res.json();

    if(!res.ok){
      msgEl.textContent = data.message || "Error creating book.";
      msgEl.className = "msg err";
      return;
    }

    localStorage.setItem("bookData", JSON.stringify(data));

    msgEl.textContent = "Success!";
    msgEl.className = "msg ok";

    setTimeout(()=>{
      window.location.href = "preview.html";
    },500);

  }catch(err){
    msgEl.textContent = "Network error.";
    msgEl.className = "msg err";
  }
});
</script>

</body>
</html>
