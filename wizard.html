<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Book Creator</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6ff;
  margin: 0;
  padding: 40px;
  text-align: center;
}

input, select {
  padding: 10px;
  margin: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

.primary { background: #111; color: white; }
.secondary { background: #eee; }

.book-stage {
  margin-top: 40px;
  perspective: 2000px;
  display: flex;
  justify-content: center;
}

.flipbook {
  position: relative;
  width: 800px;
  height: 500px;
  transform-style: preserve-3d;
}

.page {
  position: absolute;
  width: 100%;
  height: 100%;
  transform-origin: left;
  transition: transform 0.7s ease;
}

.page.flipped {
  transform: rotateY(-180deg);
}

.sheet {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 16px;
  backface-visibility: hidden;
}

.front { background: white; }
.back { background: white; transform: rotateY(180deg); }

.cover {
  background: linear-gradient(135deg, #ff7eb3, #6a5cff);
  color: white;
}

.cover-content {
  padding: 60px;
}

.cover h1 { font-size: 40px; margin-bottom: 10px; }
.cover p { font-size: 18px; }

.paper-content {
  padding: 50px;
  font-family: Georgia, serif;
  line-height: 1.7;
}

.page-num {
  position: absolute;
  bottom: 20px;
  right: 30px;
  font-size: 13px;
  color: rgba(0,0,0,0.5);
}

.shadow {
  position: absolute;
  bottom: -20px;
  width: 70%;
  height: 30px;
  left: 15%;
  background: rgba(0,0,0,0.3);
  filter: blur(15px);
  border-radius: 50%;
}
.controls {
  margin-top: 20px;
}
</style>
</head>

<body>

<h2>Create Your AI Book</h2>

<input id="child_name" placeholder="Child name" />
<select id="age">
  <option>5</option>
  <option>6</option>
  <option>7</option>
</select>

<select id="story_type">
  <option>Magical Forest</option>
  <option>Space Adventure</option>
</select>

<button class="primary" onclick="createBook()">Create Book</button>

<div class="book-stage">
  <div id="flipbook" class="flipbook"></div>
  <div class="shadow"></div>
</div>

<div class="controls">
  <button class="secondary" onclick="prevPage()">Previous</button>
  <span id="indicator">Page 0 of 0</span>
  <button class="primary" onclick="nextPage()">Next</button>
</div>

<script>

const API_BASE = "https://romantic-patience-production.up.railway.app";

let pages = [];
let currentIndex = 0;

async function createBook() {

  const payload = {
    child_name: document.getElementById("child_name").value,
    age: document.getElementById("age").value,
    story_type: document.getElementById("story_type").value
  };

  const res = await fetch(`${API_BASE}/create-book`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const data = await res.json();

  if (!data.story) return;

  buildFlipbook(data.story);
}

function buildFlipbook(storyText) {

  const flipbook = document.getElementById("flipbook");
  flipbook.innerHTML = "";

  const paragraphs = storyText.split("\n").filter(p => p.trim() !== "");

  pages = [];
  currentIndex = 0;

  // Cover
  const coverPage = document.createElement("div");
  coverPage.className = "page";
  coverPage.innerHTML = `
    <div class="sheet cover front">
      <div class="cover-content">
        <h1>My Magical Story</h1>
        <p>A Personalized Adventure</p>
      </div>
    </div>
    <div class="sheet cover back"></div>
  `;
  flipbook.appendChild(coverPage);
  pages.push(coverPage);

  // Paper Pages
  for (let i = 0; i < paragraphs.length; i += 2) {

    const page = document.createElement("div");
    page.className = "page";

    page.innerHTML = `
      <div class="sheet front">
        <div class="paper-content">
          ${paragraphs[i] || ""}
          <div class="page-num">Page ${i+1}</div>
        </div>
      </div>
      <div class="sheet back">
        <div class="paper-content">
          ${paragraphs[i+1] || ""}
          <div class="page-num">Page ${i+2}</div>
        </div>
      </div>
    `;

    flipbook.appendChild(page);
    pages.push(page);
  }

  updateIndicator();
}

function nextPage() {
  if (currentIndex < pages.length) {
    pages[currentIndex].classList.add("flipped");
    currentIndex++;
    updateIndicator();
  }
}

function prevPage() {
  if (currentIndex > 0) {
    currentIndex--;
    pages[currentIndex].classList.remove("flipped");
    updateIndicator();
  }
}

function updateIndicator() {
  document.getElementById("indicator").innerText =
    `Page ${Math.min(currentIndex + 1, pages.length)} of ${pages.length}`;
}

</script>

</body>
</html>
